create database Manejo;

use Manejo;

CREATE TABLE `login` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,	
  `USU_LOG` varchar(50) NOT NULL,
  `PAS_LOG` varchar(50) NOT NULL,
  `ROL_LOG` varchar(20) NOT NULL,
  `NOM_USU_LOG` varchar(50)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT INTO `login` (`id`, `USU_LOG`, `PAS_LOG`, `ROL_LOG`) VALUES
(1, 'Admin', 'admin', 'Administrador'),
(2, 'Christian', '2512CL', 'Docente'),
(3, 'Mateo', '15diciembre001', 'Estudiante'),
(4, 'User', 'wolfly2001', 'Invitado');

CREATE TABLE `docentes` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,	
  `CED_DOC` VARCHAR(10) UNIQUE NOT NULL,
  `NOM_DOC` VARCHAR(25) NOT NULL,
  `APE_DOC` VARCHAR(25) NOT NULL,
  `DIR_DOC` VARCHAR(50) NOT NULL,
  `COR_INS_DOC` VARCHAR(50) UNIQUE NOT NULL,
  `TEL_DOC` VARCHAR(10) NOT NULL,
  `FEC_NAC_DOC` DATE NOT NULL,
  `NOM_ARCH` VARCHAR(600),	
  `RUT_ARCH` VARCHAR(600),	
  `TIP_ARCH` VARCHAR(600),
  `TAM_ARCH` VARCHAR(50)
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `estudiantes` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,		
  `CED_EST` VARCHAR(10) UNIQUE NOT NULL,
  `NOM_EST` VARCHAR(25) NOT NULL,
  `APE_EST` VARCHAR(25) NOT NULL,
  `DIR_EST` VARCHAR(50) NOT NULL,
  `COR_INS_EST` VARCHAR(50) UNIQUE NOT NULL,
  `CEL_EST` VARCHAR(10) NOT NULL,
  `TEL_EST` VARCHAR(10) NOT NULL,
  `FEC_NAC_EST` DATE NOT NULL,
  `NOM_ARCH` VARCHAR(600),	
  `RUT_ARCH` VARCHAR(600),	
  `TIP_ARCH` VARCHAR(600),
  `TAM_ARCH` VARCHAR(50)
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `usuarios` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,	
  `CED_USU` VARCHAR(10) UNIQUE NOT NULL,
  `NOM_USU` VARCHAR(25) NOT NULL,
  `APE_USU` VARCHAR(25) NOT NULL,
  `DIR_USU` VARCHAR(50) NOT NULL,
  `COR_INS_USU` VARCHAR(50) UNIQUE NOT NULL,
  `TEL_USU` VARCHAR(10) NOT NULL,
  `FEC_NAC_USU` DATE NOT NULL,
  `NOM_ARCH` VARCHAR(600),	
  `RUT_ARCH` VARCHAR(600),	
  `TIP_ARCH` VARCHAR(600),
  `TAM_ARCH` VARCHAR(50)
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `cursos` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,	
  `COD_CUR` VARCHAR(10) UNIQUE NOT NULL,
  `NOM_CUR` VARCHAR(50) NOT NULL
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `asignaturas` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,		
  `COD_ASI` VARCHAR(10) UNIQUE NOT NULL,
  `NOM_ASI` VARCHAR(50) NOT NULL,
  `HOR_ASI` VARCHAR(25) NOT NULL,
  `CUR_ASI` INT NOT NULL REFERENCES cursos(id),
  `DOC_ASI` INT NOT NULL REFERENCES docentes(id),
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `asignacion_deberes` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,	
  `COD_ASI` INT NOT NULL REFERENCES asignaturas(id),
  `COD_DOC` INT NOT NULL REFERENCES docentes(id),
  `NOM_ASIG` VARCHAR(60) NOT NULL,	
  `DES_ASIG` VARCHAR(600) NOT NULL,
  `FEC_ASIG` DATE NOT NULL,
  `NOM_ARCH` VARCHAR(600),	
  `RUT_ARCH` VARCHAR(600),	
  `TIP_ARCH` VARCHAR(600),
  `TAM_ARCH` VARCHAR(50),
  `EST_ASIG` VARCHAR(1)
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `detalle_asignacion` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,		
  `COD_ASIG_DEB` INT NOT NULL REFERENCES asignacion_deberes(id),
  `ID_EST_ASIG` INT NOT NULL REFERENCES estudiantes(id),
  `DES_ASIG_DEB` VARCHAR(600),	
  `NOM_ARCH` VARCHAR(600),	
  `RUT_ARCH` VARCHAR(600),	
  `TIP_ARCH` VARCHAR(600),
  `TAM_ARCH` VARCHAR(50),
  `NOT_ASIG` INT
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

ALTER TABLE detalle_asignacion 
ADD `ESTADO` VARCHAR(15);

CREATE TABLE `detalle_estudiantes` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,		
  `ID_ASI` INT NOT NULL REFERENCES asignaturas(id),
  `ID_EST` INT NOT NULL REFERENCES estudiantes(id)
);

INSERT INTO `detalle_estudiantes` (`id`, `ID_ASI`, `ID_EST`) VALUES
(1, 2, 1);

CREATE TABLE `detalle_docentes` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,		
  `ID_ASI` VARCHAR(10) NOT NULL REFERENCES asignaturas(id),
  `ID_DOC` VARCHAR(25) NOT NULL REFERENCES docentes(id)
);

SELECT DA.id, DA.NOM_ARCH, DA.TIP_ARCH, DA.DES_ASIG, AD.NOM_ASIG, AD.DES_ASIG, E.NOM_EST, DA.NOT_ASIG
FROM estudiantes E, detalle_asignacion DA, asignacion_deberes AD
WHERE DA.COD_ASIG_DEB = AD.id AND DA.ID_EST_ASIG = E.id AND 
AD.COD_ASI = ? AND AD.COD_DOC = ?